<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Nathanael Hoze" />

<meta name="date" content="2024-06-20" />

<title>Using the models defined in the Rsero package</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using the models defined in the Rsero
package</h1>
<h4 class="author">Nathanael Hoze</h4>
<h4 class="date">2024-06-20</h4>



<p>This vignette presents the different models used in the
<em>Rsero</em> package, their implementation, and the different uses of
these models to fit the data. Models of the force of infection are used
to explain the change of the profile of seropositivity with age, using
as the main model assumption that an increase in seroprevalence is the
result of the cumulated exposure to a pathogen during a lifetime. We
included in this package various models of the force of infection, but
also other factors affecting the serology such as imperfect sensitivity
and specificity, waning-immunity (seroreversion) and differential risks
of exposure.</p>
<div id="the-data" class="section level2">
<h2>The data</h2>
<p>We first load the package</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(Rsero)</span></code></pre></div>
<p>The data must be in the following format</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">simulate_SeroData</span>(<span class="at">number_samples =</span> <span class="dv">5</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">print</span>(data)</span></code></pre></div>
<pre><code>## &lt;SeroData object&gt;
## 5 serological samples  
## Max age: 70  
##   age age_at_sampling     Y sampling_year location sex   category
## 1  55              55 FALSE          2019       NA All Category 1
## 2  41              41 FALSE          2019       NA All Category 1
## 3  12              12 FALSE          2019       NA All Category 1
## 4  53              53  TRUE          2019       NA All Category 1
## 5  53              53  TRUE          2019       NA All Category 1</code></pre>
</div>
<div id="models-of-the-force-of-infection" class="section level2">
<h2>Models of the force of infection</h2>
<div id="the-basic-models" class="section level3">
<h3>The basic models</h3>
<p>We considered five models that define the force of infection at a
given year:</p>
<ul>
<li>Annual hazard of infection. This model corresponds to independent,
yearly values of the force of infection.</li>
<li>Outbreak model. The force of infection is defined as a sum of
gaussians.</li>
<li>Piecewise constant model.</li>
<li>Constant force of infection.</li>
<li>Combination of constant and outbreak</li>
</ul>
<p>In the constant model a single parameter of the force of infection is
evaluated.</p>
<p>The <span class="math inline">\(piecewise\)</span> models consider
successive constant phases. They take as an input the number <span class="math inline">\(K\)</span> of different constant phases, where
<span class="math inline">\(K \geq 1\)</span>. The value <span class="math inline">\(K=1\)</span> corresponds to the constant
model.</p>
<p>In the case of the outbreak model, the force of infection at year
<span class="math inline">\(i\)</span> is given as a sum of <span class="math inline">\(K\)</span> gaussians: <span class="math display">\[\lambda_i  = \sum_{j=1}^K\bar{\alpha}_{j}
e^{-{(i-T_j)^2}}.\]</span> The <span class="math inline">\(T_j\)</span>
are the time points where the force of infection is maximal and is equal
to <span class="math inline">\(\bar{\alpha}_j\)</span>. The parameter
<span class="math inline">\(\bar{\alpha}_j\)</span> is normalized so
that <span class="math inline">\(\alpha_j=\bar{\alpha}_j \sum_i
e^{-(i-T_j)^2}\)</span>. In the case where the <span class="math inline">\(T_j\)</span> are far apart, the gaussians are well
separated and around <span class="math inline">\(T_j\)</span> the force
of infection is given by a single gaussian.</p>
</div>
<div id="using-the-models" class="section level3">
<h3>Using the models</h3>
<p>The different models are defined using the following commands</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">FOImodel</span>(<span class="at">type =</span> <span class="st">&quot;constant&quot;</span>) <span class="co"># a constant model</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">FOImodel</span>(<span class="at">type =</span> <span class="st">&quot;independent&quot;</span>) <span class="co"># independent annual force of infection</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">FOImodel</span>(<span class="at">type =</span> <span class="st">&quot;piecewise&quot;</span>, <span class="at">K =</span> <span class="dv">2</span>) <span class="co"># Two constant phase </span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">FOImodel</span>(<span class="at">type =</span> <span class="st">&quot;outbreak&quot;</span>, <span class="at">K =</span> <span class="dv">1</span>) <span class="co"># one outbreak</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">FOImodel</span>(<span class="at">type =</span> <span class="st">&quot;constantoutbreak&quot;</span>, <span class="at">K =</span> <span class="dv">2</span>) <span class="co"># two outbreaks and a constant annual force of infection</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="fu">print</span>(model)</span></code></pre></div>
<pre><code>## &lt;FOImodel object&gt;
## Model name:  constantoutbreak 
##   Estimated parameters:  7 
## Model with categories for the force of infection 
## Parameters: 
## Priors: 
##   alpha: Normal( 0.2 ,  1 )
##   T: Normal( 50 ,  20 )
##   alpha: Normal( 0.2 ,  1 )
##   T: Normal( 50 ,  20 )
##   Annual FOI: Normal( 0 ,  1 )</code></pre>
<p>Printing recapitulates the main information concerning the model. For
instance, in the <code>&quot;constantoutbreak&quot;</code> model with
<code>K=2</code>, a total of 7 parameters are estimated (1 for the
constant annual force of infection and 3 for each outbreak). The prior
distribution for the <code>alpha</code> and <code>T</code> of each
outbreak and for the annual FOI are also printed. Without additional
input the defaults normal priors are used.</p>
</div>
</div>
<div id="secondary-parameters-affecting-the-seroprevalence" class="section level2">
<h2>Secondary parameters affecting the seroprevalence</h2>
<div id="seroreversion" class="section level3">
<h3>Seroreversion</h3>
<p>Seroreversion is modeled as a rate of switching from a seropositive
state to a seronegative state. In the <em>Rsero</em> package we
implemented a combination of seroreversion with any epidemiological
model.</p>
<p>We note <span class="math inline">\(X_a(t)\)</span> the probability
that an individual born a years before the survey was seropositive <span class="math inline">\(t\)</span> years before the survey. Starting at
birth, where <span class="math inline">\(X_a(a) = 0\)</span> (i.e. we
assume all individuals are born seronegative), and considering <span class="math inline">\(\lambda_y\)</span> the FOI on year <span class="math inline">\(y\)</span> and the seroreversion rate <span class="math inline">\(\rho\)</span>, the difference equation is <span class="math display">\[
X_a(y-1) =X_a(y) e^{-(\lambda_y+\rho)}
+\frac{\lambda_y}{\lambda_y+\rho}(1-e^{-(\lambda_y+\rho)}).
\]</span> The probability that the individual is seropositive in the
survey is <span class="math inline">\(P=X_a(0)\)</span>. A parameter
<code>seroreversion = 0</code> or <code>seroreversion = 1</code> can be
defined in the <code>FOIModel</code>. By default
<code>seroreversion = 0</code>.</p>
</div>
<div id="imperfect-sensitivity-and-specificity" class="section level3">
<h3>Imperfect sensitivity and specificity</h3>
<p>The models can account for uncertainty in the seroprevalence
estimates resulting from imperfect sensitivity and specificity of the
assays. We note <span class="math inline">\(se\)</span> and <span class="math inline">\(sp\)</span> the sensitivity and specificity of the
assay, respectively. In the scenario of perfect sensitivity and
specificity (<span class="math inline">\(se=sp=1\)</span>) the
seroprevalence is the same as the proportion of the population infected
by the pathogen. In the general case, if we denote this proportion <span class="math inline">\(Inf\)</span>, the probability for an individual to
be observed as seropositive is <span class="math display">\[
P=1-sp+Inf(se+sp-1) \]</span></p>
<p>In the implementation of the package, the user can give specific
values to the sensitivity and specificity for any transmission models
and with or without seroreversion. These parameters are fixed and must
be specified by the user along with the model of the force of infection.
For example, if the sensitivity is 98% and the specificity 92%, the user
provides these number along with the FOI model.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">FOImodel</span>(<span class="at">type =</span> <span class="st">&quot;outbreak&quot;</span>, <span class="at">K =</span> <span class="dv">1</span>, <span class="at">se =</span> <span class="fl">0.98</span>, <span class="at">sp =</span> <span class="fl">0.92</span>) <span class="co"># one outbreak</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">print</span>(model)</span></code></pre></div>
<pre><code>## &lt;FOImodel object&gt;
## Model name:  outbreak 
##   Estimated parameters:  3 
## Model with categories for the force of infection 
## Parameters: 
##   K:  1 
##   Sensitivity:  0.98 
##   Specificity:  0.92 
## Priors: 
##   alpha: Normal( 0.2 ,  1 )
##   T: Normal( 50 ,  20 )</code></pre>
<p>By default <code>se = 1</code> and <code>sp = 1</code>, and the
parameters se and sp must verify that <span class="math inline">\(se+sp-1\)</span>.</p>
</div>
</div>
<div id="likelihood-from-the-annual-force-of-infection" class="section level2">
<h2>Likelihood from the annual force of infection</h2>
<p>The probability that an individual of age <span class="math inline">\(a_j\)</span> is infected depends on the history of
the force of infection during his/her lifetime. It is therefore a
function of the cumulative force of infection <span class="math inline">\(\lambda_S + \lambda_{S-1}+\dots+
\lambda_{S-a_j}\)</span>, where <span class="math inline">\(S\)</span>
is the sampling year. More specifically, the contribution to the
likelihood of a seropositive individual is <span class="math display">\[P_j = 1 - \exp\bigg(-\sum_{i = 0}^{a_j}
\lambda_{S-i}\bigg).\]</span></p>
<p>The contribution to the likelihood of a seronegative individual is
<span class="math display">\[P_j =  \exp\bigg(-\sum_{i = 0}^{a_j}
\lambda_{S-i} \bigg).\]</span></p>
</div>
<div id="setting-categories-in-the-serological-data" class="section level2">
<h2>Setting categories in the serological data</h2>
<p>Models can be defined to include different risks of infection by
category. Categories are defined in the data. Let’s look at an example
dataset provided with the package of a serological survey of CHIKV in
Vietnam. This survey was described in Quan et al., 2018 (<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5823466/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5823466/</a>)
and includes 546 individuals sampled in 4 different areas of the
country.<br />
First, we load the dataset:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>sero.data <span class="ot">=</span>  <span class="fu">read.csv</span>(<span class="st">&#39;../data-raw/CHIKVVietnam.csv&#39;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&#39;;&#39;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>chikv_vietnam <span class="ot">=</span> Rsero<span class="sc">::</span><span class="fu">SeroData</span>(<span class="at">age_at_sampling =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(sero.data<span class="sc">$</span>age)), </span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                                <span class="at">Y =</span> <span class="fu">as.numeric</span>(sero.data<span class="sc">$</span>Y)<span class="sc">&gt;</span><span class="dv">9</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>                                <span class="at">sampling_year =</span> <span class="fu">as.numeric</span>(sero.data<span class="sc">$</span>sampling_year), </span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                                <span class="at">category =</span> <span class="fu">as.character</span>(sero.data<span class="sc">$</span>Loc))</span></code></pre></div>
<p>We could have loaded the dataset directly too</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;chikv_vietnam&quot;</span>)</span></code></pre></div>
<p>We defined categories corresponding to the different regions. This
can be seen in the column <em>category</em> of the dataset
<em>chikv_vietnam</em> that associates to each individual one of the
four region:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">print</span>(chikv_vietnam<span class="sc">$</span>unique.categories) <span class="co"># the different categories</span></span></code></pre></div>
<pre><code>## [1] &quot;An Giang&quot;    &quot;Ho Chi Minh&quot; &quot;Dak Lak&quot;     &quot;Hue&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(chikv_vietnam<span class="sc">$</span>category))</span></code></pre></div>
<pre><code>##      [,1]      
## [1,] &quot;An Giang&quot;
## [2,] &quot;An Giang&quot;
## [3,] &quot;An Giang&quot;
## [4,] &quot;An Giang&quot;
## [5,] &quot;An Giang&quot;
## [6,] &quot;An Giang&quot;</code></pre>
<p>We define a model of the annual force of infection that accounts for
different risks of infection in each region.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>modelI2Full  <span class="ot">=</span><span class="fu">FOImodel</span>(<span class="at">type=</span><span class="st">&#39;piecewise&#39;</span>,</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>                       <span class="at">K=</span><span class="dv">2</span>,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>                       <span class="at">cat_lambda =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We defined an <em>piecewise</em> model, to describe that we expect a
drop of the force of infection at a certain point in time. The parameter
<em>cat_lambda = TRUE</em> is used to set different relative values of
the force of infection while keeping equal the timing of the drop in
infection probability. Therefore, the fit is done simultaneously on the
four regions.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>FOIfit.vietnam <span class="ot">=</span> <span class="fu">fit</span>(<span class="at">model =</span> modelI2full, <span class="at">data=</span>chikv_vietnam)</span></code></pre></div>
<p>An arbitrary number of categories can be defined. In the following
example we define three different categories (sex, location,
occupation).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>foi <span class="ot">=</span><span class="fl">0.01</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>ns  <span class="ot">=</span> <span class="dv">600</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>sex.list  <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;male&#39;</span>, <span class="st">&#39;female&#39;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>location.list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;Region 1&#39;</span>, <span class="st">&#39;Region 2&#39;</span>, <span class="st">&quot;Region 3&quot;</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>occupation.list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;HCW&quot;</span>,<span class="st">&quot;OTHER&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">sample</span>(sex.list,ns, <span class="at">replace=</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>location <span class="ot">&lt;-</span> <span class="fu">sample</span>(location.list,ns, <span class="at">replace=</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>occupation <span class="ot">&lt;-</span> <span class="fu">sample</span>(occupation.list, ns, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>factor <span class="ot">=</span> <span class="dv">1</span><span class="sc">*</span>(sex<span class="sc">==</span><span class="st">&#39;males&#39;</span>) <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>(sex<span class="sc">==</span><span class="st">&#39;females&#39;</span>)</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>factor <span class="ot">=</span>factor<span class="sc">*</span>( <span class="dv">1</span><span class="sc">*</span>(location<span class="sc">==</span><span class="st">&quot;Region 1&quot;</span>) <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>(location<span class="sc">==</span><span class="st">&quot;Region 2&quot;</span>) <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>(location<span class="sc">==</span><span class="st">&quot;Region 3&quot;</span>))</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>factor <span class="ot">=</span>factor<span class="sc">*</span>( <span class="dv">1</span><span class="sc">*</span>(occupation<span class="sc">==</span><span class="st">&quot;HCW&quot;</span>) <span class="sc">+</span> <span class="fl">1.1</span><span class="sc">*</span>(occupation<span class="sc">!=</span><span class="st">&quot;HCW&quot;</span>) )</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>ages <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">runif</span>(<span class="at">n=</span><span class="fu">length</span>(sex))<span class="sc">*</span><span class="dv">70</span>)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>data_tmp <span class="ot">=</span> <span class="fu">SeroData</span>(<span class="at">age_at_sampling =</span>  ages ,</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>                    <span class="at">Y =</span>  <span class="fu">runif</span>(<span class="at">n=</span>ns) <span class="sc">&lt;</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>foi<span class="sc">*</span>factor<span class="sc">*</span>ages), </span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>                    <span class="at">sampling_year =</span> <span class="dv">2023</span>,</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>                    <span class="at">category =</span> <span class="fu">cbind</span>(sex, location, occupation))</span></code></pre></div>
</div>
<div id="model-comparison" class="section level2">
<h2>Model comparison</h2>
<p>Different measures of model adequacy were implemented: The deviance
information criterion (DIC), the Akaike information criterion (AIC), the
Watanabe-Akaike information criterion (WAIC). for a detailed explanation
of all three measures, see Gelman A, Hwang J, Vehtari A. Understanding
predictive information criteria for Bayesian models. Statistics and
computing. 2014 Nov 1;24(6):997-1016.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">compute_information_criteria</span>(FOIfit.vietnam)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>modelOutbreak <span class="ot">=</span><span class="fu">FOImodel</span>(<span class="at">type=</span><span class="st">&#39;outbreak&#39;</span>,</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>                          <span class="at">K=</span><span class="dv">1</span>)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>FOIfit.vietnam2 <span class="ot">=</span> <span class="fu">fit</span>(<span class="at">model =</span> modelOutbreak, <span class="at">data=</span>chikv_vietnam)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="fu">compute_information_criteria</span>(FOIfit.vietnam2)</span></code></pre></div>
<p>The DIC of the piecewise constant model is lower than the DIC of the
outbreak model. This indicates that the former is a more adequate
description of the data. In general, DIC differences of more than 5
points with the lowest DIC indicate weak support for a model.</p>
</div>
<div id="priors" class="section level2">
<h2>Priors</h2>
<p>Normal priors were set by default for all parameters. We give below
the default values of the parameters that are mean and the standard
deviation of the normal distribution, respectively.</p>
<div id="default-prior-distributions" class="section level3">
<h3>Default prior distributions</h3>
<pre><code>                 priorY1 = 0, 
                 priorY2 = 1, 
                 priorRho1 = 0,
                 priorRho2 = 1,
                 cat_lambda = 1,
                 </code></pre>
<div id="for-the-constant-model" class="section level4">
<h4>For the constant model</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>priorC1 <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>priorC2 <span class="ot">=</span> <span class="dv">1</span></span></code></pre></div>
</div>
<div id="for-the-piecewise-constant-model" class="section level4">
<h4>For the piecewise constant model</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>priorC1 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>priorC2 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>priorT1 <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>priorT2 <span class="ot">=</span> <span class="dv">20</span></span></code></pre></div>
</div>
<div id="for-the-outbreak-model" class="section level4">
<h4>For the outbreak model</h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>prioralpha1 <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>prioralpha2 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>priorT1 <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>priorT2 <span class="ot">=</span> <span class="dv">20</span></span></code></pre></div>
</div>
<div id="for-the-constantoutbreak-model" class="section level4">
<h4>For the constant+outbreak model</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>prioralpha1 <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>prioralpha2 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>priorT1 <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>priorT2 <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>priorC1 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>priorC2 <span class="ot">=</span> <span class="dv">1</span></span></code></pre></div>
</div>
<div id="for-the-independent-model" class="section level4">
<h4>For the independent model</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>priorY1 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>priorY2 <span class="ot">=</span> <span class="dv">1</span></span></code></pre></div>
</div>
<div id="in-the-case-of-seroreversion" class="section level4">
<h4>In the case of seroreversion</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>priorRho1 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>priorRho2 <span class="ot">=</span> <span class="dv">1</span></span></code></pre></div>
</div>
</div>
<div id="specifying-the-parameters-of-the-prior-distributions-example" class="section level3">
<h3>Specifying the parameters of the prior distributions: example</h3>
<p>In the case of the <code>&quot;outbreak&quot;</code> and the
<code>&quot;constantoutbreak&quot;</code> models each outbreak can be defined by a
specific set of prior distributions. Here we set <code>K=2</code>. For
the first outbreak, the prior for <code>T</code> is normal(10,30), the
prior for alpha is normal(0,5). For the second outbreak, the prior for
<code>T</code> is normal(40,70), the prior for alpha is
uniform(0,1).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">FOImodel</span>(<span class="at">type =</span> <span class="st">&quot;outbreak&quot;</span>, <span class="at">K =</span> <span class="dv">2</span>, </span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>                  <span class="at">prioralpha1 =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">prioralpha2=</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>), </span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>                  <span class="at">priorT1 =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">40</span>), <span class="at">priorT2=</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">70</span>))</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="fu">print</span>(model)</span></code></pre></div>
<pre><code>## &lt;FOImodel object&gt;
## Model name:  outbreak 
##   Estimated parameters:  6 
## Model with categories for the force of infection 
## Parameters: 
##   K:  2 
## Priors: 
##   alpha: Normal( 0 ,  5 )
##   T: Normal( 10 ,  30 )
##   alpha: Normal( 0 ,  1 )
##   T: Normal( 40 ,  70 )</code></pre>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
